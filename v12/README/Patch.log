补丁脚本使用记录
##########################################################################################################################################################
0. 备份LOG目录
操作:将整个LOG目录打包为ZIP文件进行备份
备份文件格式:LOG_backup_YYYYMMDD_HHMMSS.zip
备份位置:项目根目录
目的:防止操作失败时数据丢失
##########################################################################################################################################################
1. 删除旧任务文件
操作:删除根目录下的旧任务文件
删除文件:
- PolicyDeviceBackupTask.py
- PolicyDeviceDIFFTask.py
目的:清理重命名后的旧文件，避免混淆
##########################################################################################################################################################
2. 重命名ACL目录
操作:处理ACL目录下的PolicyDeviceDIFFTask目录重命名
步骤:
1) 备份ACL/PolicyDeviceDIFFTask目录为ZIP文件
2) 创建ACL/DeviceDIFFTask目录
3) 移动所有文件到新目录
4) 删除旧目录
备份文件格式:PolicyDeviceDIFFTask_backup_YYYYMMDD_HHMMSS.zip
目的:与任务重命名保持一致，避免目录名混淆
##########################################################################################################################################################
3. 重命名ACL文件
目录:ACL/SourceACL/
重命名规则:
- 旧格式:YYYYMMDD-LINKAS N9K ASA含策略类设备配置备份输出EXCEL基础任务.xlsx
- 新格式:YYYYMMDD-关键设备配置备份输出EXCEL基础任务.xlsx
匹配条件:文件名以日期开头，包含"LINKAS N9K ASA含策略类设备配置备份输出EXCEL基础任务"
处理方式:直接重命名文件
##########################################################################################################################################################
4. 重命名ACL DIFF文件
目录:ACL/下所有子目录
重命名规则:
- 普通DIFF:YYYYMMDD-LINKAS N9K ASA关键设备DIFF.xlsx → YYYYMMDD-关键设备DIFF.xlsx
- 周DIFF:YYYYMMDD-周DIFF-LINKAS N9K ASA关键设备DIFF.xlsx → YYYYMMDD-周DIFF-关键设备DIFF.xlsx
- 月DIFF:YYYYMMDD-月DIFF-LINKAS N9K ASA关键设备DIFF.xlsx → YYYYMMDD-月DIFF-关键设备DIFF.xlsx
匹配条件:文件名包含"LINKAS N9K ASA关键设备DIFF"
处理方式:扫描所有ACL子目录，重命名所有DIFF文件
##########################################################################################################################################################
5. 重命名LOG日志文件
目录:LOG/YYYYMMDD/
重命名规则:
- 规则1:LINKAS_N9K_ASA含策略类设备配置备份输出EXCEL基础任务-YYYYMMDD.log → 关键设备配置备份输出EXCEL基础任务-YYYYMMDD.log
- 规则2:LINKAS_N9K_ASA关键设备DIFF-YYYYMMDD.log → 关键设备DIFF-YYYYMMDD.log
- 规则3:关键设备DIFF-YYYYMMDD.log → 保持不变（已是正确格式）
匹配条件:文件名包含特定关键词
处理方式:直接重命名文件
##########################################################################################################################################################
6. 整理LOG目录结构
源目录:LOG/YYYYMMDD/
目标目录:LOG/YYYYMMDD/OxidizedTaskBackup/
移动规则:将以YYYYMMDD-开头的.log文件移动到OxidizedTaskBackup子目录
匹配条件:文件名严格以日期开头（如20251024-xxx.log）
处理方式:创建目标目录（如果不存在），然后移动文件
##########################################################################################################################################################
7. 删除ACLNotUsedCheckTask任务与输出目录
操作:删除ACLNotUsedCheckTask相关文件和目录
删除内容:
- TASK/ACLNotUsedCheckTask.py（任务源码文件）
- TASK/__pycache__/ACLNotUsedCheckTask*.pyc（Python编译缓存文件）
- ACL/ACLNotUsedCheckTask/（任务输出目录，递归删除）
- CHECKRULE/SourceCheckIP.log（任务规则文件）
处理方式:直接删除文件和目录，如果不存在则跳过
安全措施:删除前检查文件/目录是否存在，避免错误
##########################################################################################################################################################

